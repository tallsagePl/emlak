# Emlak - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é, –≤–∫–ª—é—á–∞—é—â–∞—è:
- **Telegram –±–æ—Ç** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π  
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä—Å–µ—Ä—ã** —Å–∞–π—Ç–æ–≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
- **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** PostgreSQL
- **–ü—Ä–æ–¥–∞–∫—à–Ω –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–∞—Ä—Å–∏–Ω–≥–æ–º –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
emlak/
‚îú‚îÄ‚îÄ bot/                   # Telegram –±–æ—Ç –¥–ª—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ index.js          # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ db.js             # –ê–¥–∞–ø—Ç–µ—Ä –ë–î –¥–ª—è –±–æ—Ç–∞  
‚îÇ   ‚îú‚îÄ‚îÄ locales/          # –ü–µ—Ä–µ–≤–æ–¥—ã (ru/en/tr)
‚îÇ   ‚îî‚îÄ‚îÄ package.json      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ parser/               # –ü–∞—Ä—Å–µ—Ä—ã —Å–∞–π—Ç–æ–≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ index.js          # CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–∞—Ä—Å–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ hepsiemlak-parser.js     # –ü–∞—Ä—Å–µ—Ä HepsEmlak.com
‚îÇ   ‚îú‚îÄ‚îÄ production-scheduler.js  # –ü—Ä–æ–¥–∞–∫—à–Ω –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
‚îÇ   ‚îú‚îÄ‚îÄ database.js              # –ê–¥–∞–ø—Ç–µ—Ä –ë–î –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ package.json            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–∞—Ä—Å–µ—Ä–∞
‚îú‚îÄ‚îÄ database/             # üÜï –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ index.js          # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ schema.sql        # –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ package.json      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–¥—É–ª—è –ë–î
‚îú‚îÄ‚îÄ config.js             # –û–±—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ docker-compose.yml    # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PostgreSQL
‚îú‚îÄ‚îÄ start.sh              # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –ë–î
‚îî‚îÄ‚îÄ README.md             # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL —á–µ—Ä–µ–∑ Docker
./start.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
docker-compose up -d
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config.js`:
```javascript
const config = {
  database: {
    url: 'postgresql://postgres:111@localhost:5432/emlak'
  },
  bot: {
    token: 'YOUR_TELEGRAM_BOT_TOKEN'
  }
};
```

### 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
```bash
cd bot
npm install
npm start
```

### 4. –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞
```bash
cd parser
npm install

# –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (3 –æ–±—ä—è–≤–ª–µ–Ω–∏—è)
npm run parse:test

# –ü–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º
npm run parse

# –ü—Ä–æ–¥–∞–∫—à–Ω –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (–∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞)
npm run production
```

## üóÑÔ∏è –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ù–æ–≤–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ë–î –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è** (–æ—Ç –±–æ—Ç–∞)
- **–°–ø–∞—Ä—à–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (–æ—Ç –ø–∞—Ä—Å–µ—Ä–æ–≤) 
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é URL** (–∏–∑–±–µ–∂–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** –ø–∞—Ä—Å–µ—Ä–æ–≤
- **–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é** –æ–±—ä—è–≤–ª–µ–Ω–∏–π

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

#### `user_listings` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- –°–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
- –°—Ç–∞—Ç—É—Å—ã: live/freeze/dead
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

#### `parsed_listings` - –°–ø–∞—Ä—à–µ–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è  
- –î–∞–Ω–Ω—ã–µ —Å —Å–∞–π—Ç–æ–≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ JSONB —Ñ–æ—Ä–º–∞—Ç–µ
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
- –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ —Ü–µ–Ω—ã –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

#### `parser_processed` - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL
- –ú–∞—Å—Å–∏–≤—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL –ø–æ –∫–∞–∂–¥–æ–º—É —Å–∞–π—Ç—É
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### `parser_logs` - –õ–æ–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –£—Å–ø–µ—Ö–∏/–æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ JSONB

### API –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```javascript
const db = require('./database');

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
await db.createUserListing(data);
await db.getUserListings(owner_id);
await db.updateUserListingStatus(id, status);

// –ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã–µ  
await db.getProcessedUrls(siteName);
await db.addProcessedUrls(siteName, urls);
await db.saveParsedListing(data);

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
await db.getParserStats();
await db.getListingsStats();

// –ü–æ–∏—Å–∫
await db.searchListings({
  site_name: 'hepsiemlak',
  min_price: 1000000,
  max_price: 5000000,
  rooms: '2+1',
  location: 'Antalya'
});
```

## ü§ñ –ü–∞—Ä—Å–µ—Ä –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

### CLI –∫–æ–º–∞–Ω–¥—ã
```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤
node index.js list

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞
node index.js run hepsiemlak --test

# –ü—Ä–æ–¥–∞–∫—à–Ω –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫  
node index.js production

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
node index.js production-force hepsiemlak

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î
node index.js stats
```

### Yarn —Å–∫—Ä–∏–ø—Ç—ã
```bash
yarn parse:test           # –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (3 –æ–±—ä—è–≤–ª–µ–Ω–∏—è)
yarn parse               # –ü–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º hepsiemlak  
yarn parse:all-test      # –í—Å–µ –ø–∞—Ä—Å–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤–æ
yarn production          # –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
yarn production:test     # –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
yarn production:force    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
yarn stats              # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤
```

### –ü—Ä–æ–¥–∞–∫—à–Ω –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
- ‚è∞ **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞**: 00:00, 04:00, 08:00, 12:00, 16:00, 20:00
- üîÑ **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: –∏—Å–∫–ª—é—á–∞–µ—Ç —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ URL
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- üõ°Ô∏è **Graceful shutdown** –ø—Ä–∏ SIGINT/SIGTERM
- üìù **–ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —É—Å–ø–µ—Ö–æ–≤ –∏ –æ—à–∏–±–æ–∫

## üåê –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–∞–π—Ç—ã

### –ì–æ—Ç–æ–≤—ã–µ –ø–∞—Ä—Å–µ—Ä—ã
- ‚úÖ **HepsEmlak.com** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API –∫–∞—Ä—Ç—ã

### –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ  
- üîÑ **Sahibinden.com**
- üîÑ **Hurriyet.com.tr** 
- üîÑ **Zingate.com**

### –ò–∑–≤–ª–µ–∫–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ
- üìç **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è** (—à–∏—Ä–æ—Ç–∞/–¥–æ–ª–≥–æ—Ç–∞)
- üí∞ **–¶–µ–Ω—ã** (—á–∏—Å–ª–æ–≤—ã–µ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ)
- üè† **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏** (–ø–ª–æ—â–∞–¥—å, –∫–æ–º–Ω–∞—Ç—ã, —ç—Ç–∞–∂)
- üì∏ **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** (–º–∞—Å—Å–∏–≤ URL)
- üìû **–ö–æ–Ω—Ç–∞–∫—Ç—ã** (—Ç–µ–ª–µ—Ñ–æ–Ω—ã)
- üîó **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** (ID –æ–±—ä—è–≤–ª–µ–Ω–∏—è, –¥–∞—Ç–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤
```bash
yarn stats
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL –ø–æ —Å–∞–π—Ç–∞–º
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞  
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- –°—Ä–µ–¥–Ω–∏–µ —Ü–µ–Ω—ã –ø–æ —Å–∞–π—Ç–∞–º

### –õ–æ–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- üü¢ **SUCCESS**: —É—Å–ø–µ—à–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
- üî¥ **ERROR**: –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞  
- üîµ **INFO**: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞

1. **–°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä—Å–µ—Ä** –≤ `parser/`
```javascript
class NewSiteParser {
  async run(processedUrls = []) {
    // –õ–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
  }
}
```

2. **–î–æ–±–∞–≤—å—Ç–µ –≤ index.js**
```javascript
const PARSERS = {
  newsite: {
    name: 'NewSite.com',
    class: NewSiteParser,
    schedule: '0 */6 * * *' // –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
  }
};
```

3. **–û–±–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**
```sql
INSERT INTO parser_processed (site_name) VALUES ('newsite');
```

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ API –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ `database/index.js`:
```javascript
async customQuery(filters) {
  // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
}
```

## üê≥ Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –ë–î
docker-compose up -d

# –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ–º
docker-compose up -d --force-recreate
```

### –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
docker-compose down
docker-compose up -d

# –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞ –≤ —Ñ–æ–Ω–µ
cd parser && npm run production &

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ  
cd bot && npm start &
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=emlak
POSTGRES_USER=emlak
POSTGRES_PASSWORD=emlak123
BOT_TOKEN=your_telegram_token
```